# 北京大学肖臻老师《区块链技术与应用》公开课\_导读

2024 年 10 月 25 日 17:33

## 关键词

比特币 挖矿难度 挖矿 哈希值 SHA256 目标阈值 输出空间 算力 区块链 共识 安全性 51%攻击 分叉 以太坊 区块时间 调整 中本聪 加密货币 总算力 hash rate

## 全文摘要

比特币系统通过调整挖矿难度以维持区块产生时间稳定在 10 分钟，确保网络的安全性和效率。挖矿难度由目标阈值决定，该阈值根据 SHA256 哈希算法的输出空间动态调整，以适应网络算力的变化。每 2016 个区块后，系统依据实际出块时间与 14 天预期时间的差异，调整目标阈值，从而维持出块时间稳定。挖矿难度的调整不仅考虑了当前网络算力，还通过复杂的公式计算，确保即使在网络算力快速增长时，也能保持区块产生时间的稳定性。这一机制对于维持比特币网络的健康运行至关重要。

## 章节速览

##### 00:00 比特币系统中调整挖矿难度的原理

比特币系统通过调整目标阈值来改变挖矿难度，这直接影响到挖矿者找到满足特定哈希值条件的区块头的难度。挖矿难度与目标阈值成反比，即难度越大，目标阈值越小，反之亦然。通过 SHA256 哈希算法产生的 256 位哈希值，挖矿难度实质上是调整目标空间在可能取值中所占的比例。

##### 03:31 比特币挖矿难度调整的重要性

如果不调整挖矿难度，随着算力的增长，出块时间缩短可能导致网络分叉问题，威胁系统安全性和共识达成。调整挖矿难度可以保持出块时间稳定，维持网络的安全和效率。

##### 10:18 比特币和以太坊的出块时间及其调整策略

讨论了比特币和以太坊的出块时间设置及其调整策略。比特币的出块时间设定为十分钟，被一些人认为过长，而以太坊将其降低到 15 秒，提高了支付确认速度，但这也引出了分叉处理的新问题，需要设计新的共识协议进行解决。同时，无论出块时间设计成多长，都需要保持稳定，避免无限减小，以维持网络的健康运行。

##### 12:54 比特币挖矿难度调整机制

比特币协议中规定，每隔 2016 个区块即大约每两周调整一次挖矿难度。调整机制基于一个公式，通过计算实际生成 2016 个区块的时间与预期时间（14 天）的对比来决定难度调整的方向。若实际时间超过预期，则难度降低；反之，难度增加。调整幅度受到限制，以防止目标阈值波动过大。

##### 18:29 比特币难度调整机制解析

讨论了比特币系统中如何确保所有矿工能同时调整目标阈值，以适应挖矿难度的自动调整机制。指出，每个新挖出的区块会根据前一阶段的挖矿情况自动调整难度目标阈值，以维持平均挖矿时间在 10 分钟。此外，系统通过检查区块头中的目标阈值编码（NBS）来验证区块的合法性，确保所有节点都遵守规则。如果某个矿工不按照规则调整目标阈值，其发布的区块将不会被网络接受，从而维护了比特币网络的去中心化和安全性。

##### 21:52 比特币设计参数的来源和争议

讨论了比特币设计参数的来源，涉及中本聪是否基于论文发表或个人经验选择参数，以及这些参数的合理性和最优性。指出了比特币在设计上的一些保守特征，以及这些设计选择可能与保持现有财富相关的社区态度。同时，提到了比特币之后出现的以太坊等新价值货币，暗示了对比特币现有设计可能进行调整的需求。

##### 25:16 比特币算力及挖矿难度变化分析

讨论了比特币系统中算力和挖矿难度的变化趋势。初期算力增长缓慢，随后呈现指数级增长，与挖矿难度调整同步，以维持出块时间稳定在十分钟左右。强调了挖矿难度调整公式的理解和应用，区分了算力增长、挖矿难度变化与加密货币热度之间的关系。

## 思维导图

![思维导图图片](https://tw-efficiency.biz.aliyun.com/api/export/get/v2/yg7k9w686jxnxwd3-1730163079000-4123f2586b9d45db84a3c92d771cac4a.jpg)

## 要点回顾

##### 比特币系统中如何调整挖矿难度？

挖矿难度是通过调整目标阈值来实现的，目标阈值越小，挖矿难度越大。比特币系统使用 SHA256 算法，生成的哈希值为 256 位，整个输出空间是二的 256 次方。挖矿难度实际上是调整目标空间在输出空间中所占的比例，通俗地说就是要求的连续零的个数。难度与目标阈值成反比，当难度为一时，目标阈值对应一个较大的数值。

##### 为什么需要调整挖矿难度？

如果不调整挖矿难度，随着系统内算力的增长，出块时间会逐渐变短，从最初的十分钟变为一秒甚至更短。出块时间过短会导致网络中区块分叉增多，当出现多个分叉时，系统达成共识的能力会减弱，威胁到系统的安全性。此外，出块时间过短还可能降低 51%攻击所需的算力门槛，不利于保护比特币网络的安全。

##### 比特币协议中设定的出块时间是否为最优？

比特币协议中设定的十分钟出块时间并不一定是最优的，但必须保持一个常数的波动范围，不能无限减小。以太坊将出块时间缩短至 15 秒，并设计了新的共识协议以应对分叉问题，但这并不意味着所有加密货币都必须采用更短的出块时间。关键在于保证出块时间的稳定性和适应性。

##### 比特币协议具体是如何调整挖矿难度的？

比特币协议规定每隔 2016 个区块（大约每两周）重新调整一次目标阈值，以确保挖矿难度保持相对稳定。具体调整方法按照一定的公式进行计算，以适应网络算力的变化，避免出块时间出现无限制减小的情况。

##### 比特币系统中如何通过实际时间和目标阈值来调整挖矿难度？如何确保所有矿工能同步调整目标阈值？

在比特币系统中，实际时间是指系统生成最近 2016 个区块所花费的实际时间，而目标阈值则是预期在理想状况下（每十分钟产生一个区块）生成 2016 个区块所需的时间。当实际时间超过目标阈值（例如两个星期），意味着出块间隔变长，这时需要降低挖矿难度以增加出块的易度，因为这会导致比值增大，进而使目标阈值变大。相反，如果实际时间小于目标阈值，说明出块速度过快，这时会提高挖矿难度，使目标阈值减小。不过，在代码实现上，对目标阈值的调整有四倍的上限限制，以避免系统出现意外情况导致目标阈值剧烈波动。比特币系统的设计使得每当挖矿出 2016 个区块时，会自动进行目标阈值的调整，这是写在比特币系统的开源代码里的。即使有恶意节点不进行调整，由于每个节点需要独立验证区块的合法性，包括检查目标阈值是否正确设置，因此这类节点发布的区块将不被其他诚实矿工接受。

##### 比特币调整难度的方法是否复杂？

相对而言，比特币调整难度的方法是较为简单的。与以太坊相比，比特币的目标阈值调整是在特定数量的区块后进行，并且调整逻辑相对直接。而以太坊的难度调整更为频繁且复杂，不仅根据区块数量调整，还可能在每个新区块生成时进行。

##### 比特币的设计参数如区块时间、区块大小等是否来源于论文研究？

比特币的设计参数并非完全来自论文研究，而是结合了先前加密货币失败的经验教训以及对实用性和不实用性的一种权衡。中本聪可能基于一定的调研和思考选择了这些相对保守且合理的参数，尽管这些参数可能存在不是最优的问题，但总体上保证了比特币系统的稳定性和安全性。

##### 比特币系统的实际情况如何？

从图表数据可以看出，比特币系统的算力经历了从早期缓慢增长到近年来指数级增长的过程，尤其在加密货币市场行情高涨时表现明显。与此同时，挖矿难度也同步增长，反映出对比特币的热情越来越高。此外，出块时间保持在大约十分钟左右，说明难度调整达到了预期目的，维持了区块链的稳定挖矿速度。

## 提取 PPT

##### 00:00 比特币系统中调整挖矿难度的原理

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366264.png)

1. 挖矿难度通过调整目标空间在输出空间中的比例来控制，这直接影响到比特币哈希值的前缀零的数量，以此维持挖矿的平均时间间隔。
2. 比特币使用 SHA256 算法，产生 256 位的哈希值，意味着可能的哈希输出空间为 2 的 256 次方，精确的目标空间比例通过调整难度来实现。
3. 挖矿难度和目标阈值成反比，当难度为 1 时，对应的目标阈值较大，意味着寻找满足条件的哈希值相对容易，反之则难。
4. 调整挖矿难度是为了应对算力增加导致的区块产生时间缩短问题，以维持区块链的稳定性和安全性。
5. 如果不调整挖矿难度，随着算力增长出块时间缩短，可能导致区块链网络中的分叉问题，影响交易确认的效率和网络的整体健康。

##### 03:31 比特币挖矿难度调整的重要性

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366265.png)

1. 出块时间的缩短可能导致区块链分叉成为常态，增加系统中的分叉数量，从而影响共识达成和系统安全性。
2. 比特币协议依赖于大部分算力掌握在诚实矿工手中以确保系统安全性，51%攻击需大量算力支持，但分叉增多会分散算力，降低攻击难度。
3. 调整挖矿难度是维持出块时间稳定的关键，如比特币每隔 2016 个区块调整一次难度，以确保出块时间平均维持在 14 天左右。
4. 以太坊将出块时间缩短至 15 秒，这要求设计新的共识协议（如 Casper）来应对因分叉产生的"叔叔区块"，并给予相应的奖励（uncle reward）。
5. 平均出块时间的设定没有固定规则，但必须保持稳定，避免无限减小，以支持区块链网络的有效运行和安全性。

##### 10:18 比特币和以太坊的出块时间及其调整策略

##### 12:54 比特币挖矿难度调整机制

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366266.png)

1. 这段对话首先介绍了比特币系统中调整挖矿难度的机制，即通过对比实际产生最近 2016 个区块的时间与预期时间（2016 个区块用十分钟产生的理想时间）的差异来自动调整挖矿难度，以维持平均出块时间稳定。
2. 当实际时间超过预期时间（即区块产生速度变慢）时，表明平均出块间隔超过十分钟，系统会通过降低挖矿难度，让区块产生更容易，反之则会提高挖矿难度，以加快区块产生速度，确保网络健康运行。
3. 调整机制中包含有防止挖矿难度大幅波动的限制，即挖矿难度的上调和下调都有限制，最大调整幅度为四倍，以减少对系统稳定性的影响。
4. 调整机制通过在比特币系统内嵌入的代码实现，当达到 2016 个区块时自动进行难度调整，这种机制保证了比特币网络的自我调整能力和去中心化特性。
5. 对话还提到了比特币的初始设计参数，如出块时间设置为十分钟等，这些参数并不是基于严格的论证，而是基于中本聪的思考和经验选择的，反映了比特币系统设计的保守性。

##### 18:29 比特币难度调整机制解析

##### 21:52 比特币设计参数的来源和争议

##### 25:16 比特币算力及挖矿难度变化分析

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366267.png)

1. 在比特币系统中，算力的增长趋势呈现为初期增长缓慢，随后呈现指数级增长，这反映了加密货币市场的快速发展。
2. 算力的快速增长导致挖矿难度随之调整，保持出块时间的稳定，这符合难度调整的设计目标，以应对算力的提升。
3. 近半年的挖矿难度调整曲线显示，难度每隔两周就会上升，这表明参与挖矿的人数和使用的设备都在增加，反映出对比特币的高热情。
4. 如果加密货币的挖矿难度不断降低，意味着挖矿变得越来越容易，这通常不是一个好兆头，表明市场对该加密货币的兴趣正在减少。
5. 持续的挖矿难度下调可能预示着该加密货币的长期价值和社区参与度下降，长期来看可能不利于其发展。

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366268.png)

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366269.png)

1. 近半年的出货时间平均维持在十分钟左右，显示了作业或任务处理的效率水平。
2. 最后提到的 PPT 是本门课程的教科书配套材料，特别强调了调整挖矿难度的公式，指出这个公式与课堂上给出的有所不同，提示学习者注意公式的细节和区别。
3. 强调了课堂上与 PPT 中关于挖矿难度与目标阈值计算方法的区别，提醒学生们理解“挖矿难度”与“目标阈值”是成反比的，防止概念混淆。
4. 指出在比特币的代码实现中使用的是目标允许，这是在讨论具体技术应用时的特别注意点。

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/p7g395emllp59z65/23366270.png)
