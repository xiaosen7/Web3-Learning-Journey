## 00:06 ~ 02:38 比特币交易脚本语言介绍详解

在这段时间内，发言人详细介绍了比特币交易中使用的脚本语言。比特币的交易实例包括一个输入和两个输出。输入脚本包含两个操作，将两个长字符串压入栈中。比特币的脚本语言是一种基于栈的语言，唯一能访问的内存空间是一个堆栈。交易的宏观信息包括交易 ID、哈希值、版本、大小和锁定时间。锁定时间为零表示交易立即生效。输入部分包括交易的来源和输入脚本，输出部分包括输出金额和输出脚本。输出脚本的内容包括一系列操作，最简单的形式是给出收款人的公钥并检查签名。

发言人 00:06
比特币交易脚本语言是一种基于栈的语言。比特币的交易实例包括一个输入和两个输出。输入脚本包含两个操作，将两个长字符串压入栈中。

发言人 00:30
比特币的脚本语言是一种基于栈的语言，唯一能访问的内存空间是一个堆栈。交易的宏观信息包括交易 ID、哈希值、版本、大小和锁定时间。锁定时间为零表示交易立即生效。

发言人 01:00
输入部分包括交易的来源和输入脚本，输出部分包括输出金额和输出脚本。输出脚本的内容包括一系列操作，最简单的形式是给出收款人的公钥并检查签名。

发言人 01:30
比特币交易的合法性通过验证输入脚本和输出脚本的执行结果来确定。如果执行过程中没有错误且栈顶结果为非零值，则交易合法。否则，交易非法。

发言人 02:00
比特币交易脚本语言的设计非常简单，但在密码学相关的功能上非常强大。例如，check multi sig 操作可以用一条语句完成多重签名验证。比特币脚本语言针对比特币的应用场景做了很好的优化，尽管简单但非常实用。

发言人 02:30
比特币脚本语言不支持循环，因此没有死循环问题，也不用担心停机问题（Halting Problem）。这样的设计是有其用意的，不支持循环就不会有死循环。

## 02:38 ~ 06:42 比特币交易输入和输出脚本执行过程

在这段时间内，发言人详细讲解了比特币交易输入和输出脚本的执行过程。首先，输入脚本和输出脚本拼接在一起执行。输入脚本包含签名，输出脚本包含公钥和检查签名的操作。执行时，先将签名压入栈，再将公钥压入栈，最后检查签名的正确性。比特币交易的合法性通过验证输入脚本和输出脚本的执行结果来确定。如果执行过程中没有错误且栈顶结果为非零值，则交易合法。否则，交易非法。

## 06:42 ~ 10:25 比特币交易脚本的几种形式

在这段时间内，发言人介绍了比特币交易脚本的几种形式。最简单的形式是 pay to public key，输出脚本直接给出收款人的公钥，输入脚本给出签名。另一种常用形式是 pay to public key hash，输出脚本给出公钥的哈希值，输入脚本给出签名和公钥。执行时，先将签名和公钥压入栈，再将公钥的哈希值压入栈，最后检查签名的正确性。最复杂的形式是 pay to script hash，输出脚本给出赎回脚本的哈希值，输入脚本给出赎回脚本和签名。验证时，先检查赎回脚本的哈希值是否匹配，再执行赎回脚本的内容。

## 10:25 ~ 14:57 比特币交易脚本实例

在这段时间内，发言人通过实例讲解了比特币交易脚本的执行过程。pay to public key 实例中，输入脚本包含签名，输出脚本包含公钥和检查签名的操作。pay to public key hash 实例中，输入脚本包含签名和公钥，输出脚本包含公钥的哈希值和检查签名的操作。执行时，先将签名和公钥压入栈，再将公钥的哈希值压入栈，最后检查签名的正确性。pay to script hash 实例中，输入脚本包含签名和赎回脚本，输出脚本包含赎回脚本的哈希值。验证时，先检查赎回脚本的哈希值是否匹配，再执行赎回脚本的内容。

## 14:57 ~ 19:52 比特币交易脚本的复杂应用

在这段时间内，发言人介绍了比特币交易脚本的复杂应用。pay to script hash 功能通过软分叉加入比特币系统，常用于多重签名支持。多重签名要求多个签名才能取出账户上的钱，为私钥泄露和丢失提供安全保护。check multi sig 操作用于验证多重签名，输出脚本给出 N 个公钥和阈值 M，输入脚本提供 N 个公钥对应的 M 个签名。执行时，先将签名和公钥压入栈，再检查签名的正确性。由于 check multi sig 实现有 bug，输入脚本需多压入一个无用元素。

## 19:52 ~ 22:46 比特币交易脚本的多重签名实现

在这段时间内，发言人详细讲解了比特币交易脚本的多重签名实现。多重签名要求多个签名才能取出账户上的钱，为私钥泄露和丢失提供安全保护。check multi sig 操作用于验证多重签名，输出脚本给出 N 个公钥和阈值 M，输入脚本提供 N 个公钥对应的 M 个签名。执行时，先将签名和公钥压入栈，再检查签名的正确性。由于 check multi sig 实现有 bug，输入脚本需多压入一个无用元素。签名的相对顺序需与公钥的相对顺序一致。

## 22:46 ~ 27:15 比特币交易脚本的赎回脚本

在这段时间内，发言人介绍了比特币交易脚本中的赎回脚本。赎回脚本是在输入脚本里提供的，由收款人提供。发言人通过网上购物的例子解释了赎回脚本的用意。电商在网站上公布赎回脚本的哈希值，用户生成转账交易时将哈希值包含在输出脚本里。电商在花掉这笔输出时提供输入脚本，其中包含赎回脚本的序列化版本和所需的签名。用户只需包含哈希值，其他细节对用户不可见。赎回脚本的多重签名规则可以随时更改，只需更新哈希值。

## 27:15 ~ 30:11 比特币交易脚本的执行过程

在这段时间内，发言人详细讲解了比特币交易脚本的执行过程。首先将输入脚本和输出脚本拼接在一起。输入脚本包含一个无用的元素（为应付 check multi sig 的 bug），两个签名和序列化的赎回脚本。执行时，先将无用元素压入栈，再依次将两个签名和赎回脚本压入栈。然后执行输出脚本，取赎回脚本的哈希值并与输出脚本提供的哈希值比较。如果相等，第一阶段验证完成。接着展开赎回脚本并执行，验证签名的正确性。

## 30:11 ~ 33:00 比特币交易脚本的多重签名应用

在这段时间内，发言人介绍了比特币交易脚本的多重签名应用。多重签名要求多个签名才能取出账户上的钱，为私钥泄露和丢失提供安全保护。比特币系统中，check multi sig 操作用于验证多重签名，输出脚本给出 N 个公钥和阈值 M，输入脚本提供 N 个公钥对应的 M 个签名。执行时，先将签名和公钥压入栈，再检查签名的正确性。由于 check multi sig 实现有 bug，输入脚本需多压入一个无用元素。签名的相对顺序需与公钥的相对顺序一致。

## 33:00 ~ 36:00 比特币交易脚本的实际应用

在这段时间内，发言人通过实例讲解了比特币交易脚本的实际应用。发言人解释了如何在实际交易中使用赎回脚本和多重签名。电商在网站上公布赎回脚本的哈希值，用户生成转账交易时将哈希值包含在输出脚本里。电商在花掉这笔输出时提供输入脚本，其中包含赎回脚本的序列化版本和所需的签名。赎回脚本的多重签名规则可以随时更改，只需更新哈希值。通过实例，发言人展示了比特币交易脚本在实际应用中的灵活性和安全性。

## 36:00 ~ 39:55 比特币交易脚本的销毁比特币方法

在这段时间内，发言人介绍了一种特殊的比特币交易脚本格式，该格式的输出脚本以 return 操作开头，后面可以跟任意内容。由于 return 操作会无条件返回错误，包含该操作的脚本永远无法通过验证，因此这笔比特币将永远无法花费出去。这种方法被用来销毁比特币。发言人解释了销毁比特币的两种应用场景：一种是为了获得某些小币种（如 altcoin），需要销毁一定数量的比特币；另一种是为了在区块链中写入一些需要永久保存的内容，如知识产权的哈希值。通过这种方法，可以证明在某个时间点已经知道某些信息，而不泄露具体内容。

## 39:55 ~ 41:01 比特币脚本语言的设计特点

在这段时间内，发言人总结了比特币脚本语言的设计特点。比特币脚本语言非常简单，甚至没有专门的名字，就叫比特币脚本语言（Bitcoin Scripting Language）。它不支持循环，因此没有死循环问题，也不用担心停机问题（Halting Problem）。虽然功能有限，但在密码学相关的功能上非常强大，例如 check multi sig 操作可以用一条语句完成多重签名验证。比特币脚本语言针对比特币的应用场景做了很好的优化，尽管简单但非常实用。
