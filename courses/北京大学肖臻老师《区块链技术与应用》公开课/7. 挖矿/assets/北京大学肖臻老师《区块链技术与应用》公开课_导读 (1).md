# 北京大学肖臻老师《区块链技术与应用》公开课_导读
2024年10月29日 09:17

## 关键词
比特币 挖矿 全节点 清节点 UTXO 挖矿难度 区块 最长合法链 SPV 轻节点 算力 GPU 深度学习 密码学 共识机制 挖矿设备 演化趋势 比特币价格 加密货币 噪音 


## 全文摘要
比特币挖矿是区块链网络的基础，涉及全节点和轻节点（SPV）两种节点类型，其中全节点负责维护完整区块链，验证交易与区块合法性，而轻节点依赖全节点验证交易，受限于不完整信息。随着技术进步，比特币挖矿设备从CPU、GPU发展至高效的ASIC芯片，显著提升了挖矿效率与专业化水平。矿池的出现，集合矿工算力共同挖矿，为矿工提供收益稳定性的优势，但同时也增加了51%攻击和分叉攻击的风险，威胁比特币安全性和去中心化原则。综上，尽管矿池优化了挖矿效率和收益稳定性，其潜在安全风险不容忽视。


## 章节速览
##### 00:00 比特币工作原理及挖矿趋势总结
总结了比特币网络中全节点和轻节点的不同角色与功能，全节点负责维护完整区块链信息，验证交易合法性，而轻节点主要验证交易相关性与挖矿难度，不具备验证交易完整合法性的能力。同时，讨论了比特币挖矿中的趋势，强调了沿最长合法链挖矿的重要性，以及轻节点在比特币网络中的作用与局限。

##### 06:19 挖矿过程中遇到合法新区块的处理策略
当挖矿过程中监听到合法的新区块且其位于最长合法链上时，应当停止当前挖矿活动，重新组织区块。这是因新发布的区块可能包含原候选区块中的交易，或改变区块头的哈希值及指针。尽管这可能看似可惜，但挖矿的无记忆性保证了继续挖矿或重新开始对结果的影响相同。安全性主要通过密码学保证交易的合法性和共识机制维护网络的一致性来实现。挖矿设备的选择和优化也是挖矿成功的关键因素之一。

##### 12:07 挖矿设备演进：从CPU到GPU再到ASIC
早期挖矿主要依靠CPU，但由于其效率低下，逐渐转向GPU以提升性能。然而，随着比特币挖矿难度增加和GPU价格飙升，其用于挖矿的性价比降低。ASIC（专用集成电路）芯片因其专为挖矿设计，能效比高，成为主流。ASIC矿机的研发周期长，比特币价格波动可能影响其投资回报，同时引发市场竞争加剧。矿工们需关注市场动态，及时调整设备以保持竞争力。

##### 21:10 挖矿设备演进与去中心化理念的冲突
挖矿设备从通用CPU到GPU，再到ASIC，越来越专业，导致了对通用计算机挖矿能力的下降。虽然ASIC提高了挖矿效率，但降低了普通用户参与的可能性，违背了比特币的去中心化初衷。新型加密货币通过设计不同的挖矿机制，如抗ASIC的挖矿难题，旨在保持挖矿的民主性，让通用计算机也能参与挖矿。同时，大型矿池的出现使得单个矿工即使使用先进的挖矿设备，也难以稳定获得收益，进一步集中了挖矿资源。

##### 25:44 矿池运作及矿工收入分配机制
矿池由矿主管理，负责收集交易组织区块，而矿工仅负责计算哈希值。矿工按贡献大小分配挖矿收益，机制需保证矿工努力的公正性。矿工间存在工作量证明，用于评估挖矿努力，而非仅仅依靠计算哈希值的速度。矿池内的收入分配方法需避免‘大锅饭’现象，保证矿工的积极性。矿工提交的算力能作为贡献的证明，当矿工挖到合法区块时，其收益将根据提交的算力比例进行分配。为防止矿工私下挖矿及提交新区块，矿池设计了任务分配及验证机制，确保矿工挖到的合法区块能被有效识别和奖励。此外，矿池的竞争和联盟现象也影响着矿工的收益分配及矿池的长期发展。

##### 38:13 矿池集中度与比特币51%攻击风险
讨论了矿池集中度对比特币网络安全的影响，特别是当某个矿池占有大量算力时，可能引发的51%攻击风险。51%攻击允许攻击者通过控制超过半数的网络算力来发起分叉攻击，篡改交易记录，对区块链的安全性和稳定性构成威胁。此外，通过分散隐藏算力和临时集中，攻击者可以在不引起注意的情况下发动攻击。

##### 44:46 区块链分叉攻击及其后果
讨论了在区块链技术中，攻击者如何利用分叉攻击来阻止特定交易，特别是当攻击者拥有超过50%的网络算力时，可以轻易地分叉链以阻止合法交易的确认。这种攻击方式不仅影响交易的确认，还可能导致矿工放弃继续在受影响的区块上工作，进而影响区块链网络的稳定性和安全性。同时，提到了挖矿池的出现提高了矿工的挖矿效率和收入稳定性，但同时也增加了51%攻击的风险。


## 思维导图
![思维导图图片](https://tw-efficiency.biz.aliyun.com/api/export/get/v2/3kprql7jgyz9xgd8-1730168614000-3c1a0a6427bc4705aef2075f17a72f54.jpg)
## 要点回顾
##### 比特币网络中的节点类型有哪些，它们的职责是什么？
比特币网络中有两种节点，分别是全节点和清节点（SPV，即Simplified Payment Verification）。全节点始终在线，维护完整的区块链信息、UTXO集合以及验证交易的正确性，监听并确认新交易以及区块的有效性，决定哪些交易会被打包进区块中。清节点则不是一直在线，它仅连接到比特币网络中的轻节点，不保存整个区块链信息，而只保存每个区块的头部信息，通过这种方式节省存储空间。清节点无法验证所有交易的合法性，但它可以验证区块的合法性和挖矿难度，并检测区块是否在延伸最长合法链。

##### 当收到新的合法区块时，清节点应如何操作？
当清节点接收到一个新的合法区块时，它需要停止当前的挖矿过程，重新组装一个候选区块，并从头开始挖矿。这是因为新发布的区块可能包含之前已有的交易，同时区块头中的信息也会发生变化，如MAC地址和指向前一个区块的指针等。

##### 全节点在验证区块时，主要检查哪些内容？清节点如何确保其存储的区块符合挖矿难度要求？
全节点在验证区块时，首先会检查区块内的每个交易是否合法，包括验证铸币交易（即coinbase transaction）的奖励数量是否正确，以及确认区块的哈希值前是否有足够多的零来满足难度要求。此外，全节点每两周会根据比特币协议调整挖矿难度，并确保区块是在延续最长合法链上。清节点虽然无法直接验证区块中所有交易的合法性，但它可以检查发布到网络上的区块是否符合挖矿难度要求。这是因为挖矿过程中计算哈希值仅使用了块头信息，而清节点保存了完整的块头信息，所以能够验证区块的难度要求。

##### 挖矿过程中的无记忆性特性意味着什么？
挖矿过程具有无记忆性，即无论是否改变当前区块，只要还未达到符合要求的难度值，之前的挖矿时间都不影响最终结果。因此，即使前面的工作量很大，一旦有新发布的合法区块，清节点只需重新组装区块并继续挖矿，不必担心之前的努力白费。

##### 比特币的安全性是如何保证的？
比特币的安全性主要依赖于密码学和共识机制两个方面。密码学确保了只有拥有私钥的人才能伪造签名，从而保护用户资产不被未经授权转移。而共识机制则要求拥有大多数算力的矿工遵循协议，不接受无效交易，这两者结合保证了比特币系统的安全性。

##### 挖矿设备的演化趋势是怎样的？为什么GPU挖矿不如 ASIC 芯片挖矿性价比高？
挖矿设备的演化趋势是从最初使用普通的CPU，到第二代使用GPU，再到现在的ASIC芯片。CPU挖矿由于效率低下且不经济，逐渐被淘汰；GPU虽然相比CPU提高了效率，但由于其设计的通用性，仍存在资源闲置问题，且价格随着深度学习领域的火热而上涨，现在已超过比特币挖矿难度上限，不再被广泛用于挖矿。GPU虽然提高了挖矿效率，但它的设计目的是通用并行计算，如深度学习，因此对于比特币挖矿中仅需整数操作的部分存在大量闲置部件，造成浪费。而ASIC芯片则是专门为挖矿设计的专用芯片，具有最高的性价比，但研发周期长，一旦比特币价格剧烈波动，前期投入的研发费用可能无法回收。

##### 目前主要使用什么设备进行比特币挖矿？购买ASIC矿机时需要注意什么？
目前一般使用ASIC芯片进行比特币挖矿，因为它针对比特币挖矿优化设计，性价比最高，且无法用于其他应用。购买ASIC矿机时需注意时机，上市初期两个月往往利润最高，之后随着更强大矿机的出现利润会逐渐减少。同时，购买前要预先预定，因为厂商可能因自身挖矿而延迟发货，造成矿工的经济损失。

##### ASIC芯片的特点是什么？
ASIC芯片是专门为特定加密货币挖矿设计的，具有高效率但不能做其他事情，且不同加密货币对应的ASIC芯片不能互相通用。每款ASIC芯片的研发周期很长，如果比特币价格在研发期间大幅下跌，可能导致投资损失。

##### 对于挖矿设备从通用到专用的变化，有何看法？
虽然这种趋势让挖矿变得越来越专业化，提高了效率，但也有人认为这违背了比特币去中心化的初衷，使得普通人通过家用电脑参与挖矿的机会减少。然而，也有一些新的加密货币设计了抗ASIC化的工作量证明机制，以鼓励更多设备参与挖矿。

##### 挖矿过程中，单个矿工面临的主要问题是什么？
单个矿工在挖矿时面临的主要问题是收入的不稳定性。由于比特币系统中区块产生的时间间隔较长，单个矿工可能需要花费数年时间才能挖出一个区块，而这一过程中产生的电费成本高昂，类似买彩票中奖的概率极低，一旦成功挖矿则收益丰厚，但失败的话则会损失大量电费。

##### 矿池有哪些组织形式？
矿池有两种主要组织形式：一种是集中式，矿机属于同一个机构，物理上位于同一地点，收入分配相对简单；另一种是分布式，矿工和矿主分布在世界各地，通过网络协议进行联系，矿工根据指示计算哈希值并将结果返回给矿主，待有出块奖励时一起参与分红。

##### 大型矿池是如何解决单个矿工收入不稳定的问题的？
大型矿池通过将众多矿工组织起来作为一个整体来共同承担挖矿任务，并共享收益。矿池通常有一个矿主（pool manager），负责管理和协调矿机，包括监听交易、组织打包候选区块以及应对其他节点抢先发布区块的情况。矿工则只负责计算哈希值，其他全节点职责由矿主承担。这样，矿工们可以共享挖矿带来的收益，通过平均分配或根据贡献大小分配的方式减少单个矿工因收入不稳定带来的风险。

##### 如何证明每个矿工所做的工作量？
为了证明每个矿工所做的工作量，矿池采用工作量证明机制。在降低挖矿难度后，矿工不再需要找到符合严格条件的区块，而是只要找到满足一定条件（如前60个0）的“share”即可。矿工将这些share提交给矿主，矿主记录每个矿工提交的share数量，在某个矿工成功挖到合法区块后，根据工作量分配出块奖励。这样，矿工挖矿的概率与其尝试的nance数目成正比，share的数量可作为衡量其工作量的依据。

##### 是否存在矿工挖到合法区块后不提交给矿主，而是自己发布以获取出块奖励的可能性？
这种行为是不可能发生的。因为矿工的任务是由矿主分配的，包含了特定的coin base parameter范围。此外，区块内的收款地址是预先设定为矿主的地址，如果矿工试图更改收款地址并自己发布区块，由于交易列表和mogo tree根哈希值的变化，矿主将不会认可这部分工作量证明，因此矿工无法成功获取出块奖励。

##### 矿工是否有可能故意不提交自己挖到的合法区块，以打击竞争对手？
有可能。如果矿工想捣乱或者打击竞争对手，他们可以这样做。虽然这对他自身没有经济好处，但如果丢弃自己的合法区块不提交，那么竞争对手将无法获得出块奖励，而他自己虽然也参与了分红，但却是通过损害其他矿工的利益来实现的。

##### 当前比特币网络中矿池的分布情况如何？是否存在绝对优势的矿池？
根据统计数据，中国的矿池占据了全球81%的算力，具有绝对优势。不过，单个矿池的算力分布已较为分散，没有哪个矿池占据一半以上算力，看似降低了单一矿池发动51%攻击的风险。

##### 如果某个机构拥有半数以上的算力，他们如何隐藏并集中这些算力发动攻击？大型矿池对矿工有何影响？
拥有半数以上算力的机构不必将所有算力放在一个矿池中，可以分散隐藏在多个矿池里。平时分散隐藏，需要发动攻击时集中起来。矿工转换矿池相对容易，只需按照新矿池的通讯协议与矿主联系即可。这样，攻击者只需吸引足够多的矿工加入其矿池，即可发动攻击。大型矿池为矿工减轻了负担，提高了挖矿效率和收入稳定性，类似云计算中的按需计算模式。然而，矿池也带来了潜在危害，如更容易发动51%攻击，使整个网络面临风险。

##### 攻击者利用51%算力能采取哪些类型的攻击？51%攻击是否意味着攻击者可以随意转移他人账户资金？
攻击者可以进行分叉攻击（forking attack），通过创建分支链来回滚交易；还可以实施封锁禁欲（boycott），即阻止特定账户的交易上链，一旦发现相关交易就立即发起分叉攻击，阻止该账户的交易确认。不可以。攻击者虽然拥有强大的算力，但没有目标账户的私钥，因此无法伪造签名进行转账。即便发布没有合法签名的交易，也会导致区块链分叉，其他矿工不会沿用，从而保护了用户资产的安全性。


## 提取PPT
##### 00:00 比特币工作原理及挖矿趋势总结
![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570270.png)
1. 全节点维护完整区块链信息，包括UTXO集合，确保交易合法性，监听并验证网络交易，决定合法交易的区块打包。
2. 全节点验证新挖出区块的合法性，包括检查交易合法性、区块头哈希值的0的数目、难度目标阈值，以及区块延伸的最长合法链。
3. 全节点负责调整挖矿难度，每两周根据比特币协议要求进行，确保网络稳定。
4. 挖矿选择最长合法链进行，遇到等长分叉时，全节点默认选择最先听到的分叉，以维护区块链的连续性和一致性。

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570271.png)
1. 清节点，有时也称为SPV（Client simplified payment verification），是指那些不保存整个区块链所有区块，而只保存区块头的节点。这使得清节点能够以极小的存储需求参与比特币网络，与全节点相比，其数据存储需求减少了大约1000倍。
2. 清节点不保存所有交易信息，只保留与其相关的交易，这使得它们无法验证大多数交易的合法性，也无法检测到“双重支付”情况。然而，它们可以验证挖矿难度，确保发布的区块符合难度要求。
3. 比特币网络中绝大多数节点都是清节点，适合普通用户进行转账等基本操作，无需运行资源消耗大的全节点。这不仅降低了用户参与网络的门槛，也保持了网络的去中心化特性。
4. 挖矿设备的演化趋势是从通用设备（如CPU）到专业设备（如ASIC），再到现在最高效的专用挖矿芯片。这一过程反映了挖矿难度的增加和对更高效率硬件需求的上升。
5. 大型矿池的出现解决了单个矿工收入不稳定和承担全节点职责过重的问题。矿池通过集中计算能力和共享收益，使矿工们能够更稳定地获得挖矿奖励，同时减轻了个体矿工的负担。

##### 06:19 挖矿过程中遇到合法新区块的处理策略
##### 12:07 挖矿设备演进：从CPU到GPU再到ASIC
##### 21:10 挖矿设备演进与去中心化理念的冲突
##### 25:44 矿池运作及矿工收入分配机制
![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570272.png)

##### 38:13 矿池集中度与比特币51%攻击风险
![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570273.png)
1. 在2014年，一个名为ghash.io的矿池曾占据全球算力超过一半，引发了对51%攻击风险的担忧。
2. 这一集中算力的现象威胁到了比特币网络的安全，可能导致操控区块链的能力。
3. 面对这一情况，ghash.io矿池主动减少了其算力占比，以缓解市场恐慌并维护比特币的信心。
4. 事件后，比特币的算力分布变得更加分散，降低了单一矿池控制网络的风险。

![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570274.png)
1. 大型矿池的出现使得比特币挖矿变得更加集中，虽然没有一个矿池占据超过一半的算力，但这种集中化加剧了挖矿的不平等，增加了攻击者发动51%攻击的风险。
2. 矿池的存在降低了矿工的挖矿门槛，矿工无需关心复杂的网络协议，只需专注计算哈希值，这提高了挖矿的效率，但同时也可能被利用来发动攻击。
3. 发动51%的攻击变得更为容易，因为攻击者可以通过召集足够数量的矿工加入特定的矿池，从而达到控制网络算力超过半数的目的，这威胁了比特币网络的安全。
4. 攻击者可能通过分叉攻击和封锁交易（boycott）等手段对特定账户或交易进行攻击，从而达到控制网络或影响交易合法性的目的，这些行为破坏了比特币网络的共识机制。
5. 大型矿池的存在使得矿工的收入更加稳定，他们每天都有挖出区块的机会，尽管可能只获得较小的奖励，但与过去一次挖出大额奖励相比，现在有持续的小额收入。

##### 44:46 区块链分叉攻击及其后果
![PPT图片](https://tw-efficiency.biz.aliyun.com/api/lab/get/v2/zj78qpded5vrqxdp/23570275.png)


