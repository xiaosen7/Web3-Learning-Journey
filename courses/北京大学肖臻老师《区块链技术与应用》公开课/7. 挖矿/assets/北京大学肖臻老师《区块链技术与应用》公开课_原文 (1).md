北京大学肖臻老师《区块链技术与应用》公开课\_原文
2024 年 10 月 29 日 09:17
发言人 00:07
前面几节课我们已经讲完了比特币工作的基本原理。这节课我们先总结一下相关内容，然后讲一下比特币挖矿中的一些趋势。我们前面说过，比特币中有两种节点，一种是全节点，一种是轻节点。全节点一般是一直在线的，在本地硬盘上维护完整的区块链信息。在内存中要维护 UTXO 集合，即未花费交易输出集合，以便快速检验交易的正确性，监听比特币网络上的交易信息，然后验证每个交易的合法性。是否有合法的签名，是否存在双重支付？全节点要决定哪些交易会被打包到区块里。缺省状况下，只要是合法的交易，并且交易费符合要求，就会被打包进去。同时要监听其他矿工挖出来的区块，验证其合法性。

发言人 01:29
这个验证从三个方面进行。首先，区块中的每个交易都要合法，包括铸币交易（coinbase transaction），例如是否篡改了区块奖励。当前的初始奖励是 12.5 个比特币，是否篡改发布的区块是否符合难度要求。通俗地说，就是检查区块头的哈希值前面是否有足够多的 0。同时也要检查区块头中的难度目标阈值设置是否正确。然后，全节点每两周还要按照比特币协议的要求调整挖矿难度。

发言人 02:18
第三点是检查区块是否在延伸最长合法链。然后是挖矿，前面这些步骤都是在为挖矿做准备，这一步才是真正能够带来收益的挖矿。挖矿分为两部分，第一部分是决定沿着哪条链挖下去，缺省情况下应该是沿着最长合法链挖下去。当出现等长的分叉时，选择最先听到的那个分叉。这是全节点的职责。

发言人 03:01
那么轻节点呢？轻节点有时也叫做 SPV（Simplified Payment Verification）。

发言人 03:13
轻节点一般来说不像全节点那样一直在线。轻节点不保存整个区块链的信息，只保存每个区块的头部信息。这样可以节省大量存储空间，约为存储整个区块链的 1/1000。

发言人 03:44
轻节点不保存全部的交易信息，只保存与自己相关的交易。它无法验证大多数交易的合法性，因为没有完整的交易信息，所以无法检测双重支付。它只能检测与自己相关的交易的合法性。

发言人 04:11
轻节点无法检测网上发布的区块的正确性，因为无法验证区块中包含的交易是否合法。但它可以验证挖矿的难度，即发布的区块是否符合难度要求。因为挖矿时计算哈希值只用到区块头的信息，而轻节点保存了完整的区块头信息，所以可以验证区块的难度要求。轻节点假设发布区块的全节点不会发布非法交易，因为发布非法交易对全节点没有好处。

发言人 05:05
另外，轻节点只能检测哪个是最长链，无法检测哪个是最长合法链，因为无法验证链上包含的交易是否合法。但轻节点可以检测链上包含的区块是否符合挖矿难度要求。

发言人 05:31
假设矿工是理智的，不会沿着不合法的链挖下去，因为挖出一个区块的代价很大，需要做大量的工作才能挖出一个区块。如果挖出的区块被发现包含非法交易，那就白挖了。所以轻节点假设全节点矿工不会这样做。大家有什么问题吗？比特币网络中大部分节点都是轻节点。如果你只是想进行转账，不需要挖矿，那么没必要运行一个全节点，只用一个轻节点就可以了。

发言人 06:21
在挖矿过程中，如果监听到别人发布的一个合法区块，并且该区块位于最长合法链上，这时应该怎么办？应该停止已有的挖矿，重新组织，在本地组装一个候选区块，然后重新进行挖矿。为什么要这样做？因为沿着新发布的区块往下挖，本地组装的区块中包含的交易会发生变化。有些交易可能已经被包含到新发布的区块中。另外，区块头的信息也会变化，如交易组成的 Merkle 树根哈希值和指向前一个区块的指针等。所以要停止已有的挖矿，重新组装一个候选区块，然后从头开始挖。

发言人 07:32
这样做是不是有些可惜？费了半天劲，已经挖了很长时间了，现在别人发布一个新的区块，前面的努力都白费了，还得重新组装一个区块，然后再继续挖，这是不是比较可惜？其实不可惜。为什么？因为我们前面讲过挖矿的一个性质是无记忆性。

发言人 08:12
叫 memoryless，也可以叫 progress free。

发言人 08:27
所以无论是继续挖原来的区块，还是停下来改成挖一个新组装的区块，成功的概率是一样的。只要当前还没有挖到符合要求的 nonce 值，前面已经挖了多长时间，其实对最后的结果没有影响。所以这并不可惜。

发言人 08:56
即使挖到了合法的区块，发布出去，发布到区块链上，也不是说就胜利了。有可能发布的区块最终没有成为最长合法链，可能存在一些竞争条件，别人同时发布了一个合法的区块，或者存在一些你不知道的双重支付，使得区块中某些交易最后变成有冲突的。大家对这个过程有什么问题吗？我们讲的是全节点和轻节点的职责，以及挖矿中的一些注意事项。那我来问个问题，比特币是怎么保证安全性的？

发言人 09:55
比特币的安全性是从两方面保证的。一方面是密码学上的保证，另一方面是共识机制。密码学上的保证是别人没有你的私钥就无法伪造你的签名，所以也就不能把你账上的钱转走。大家注意，这个前提是系统中拥有大多数算力的矿工是好的，是遵守协议的，不会接受那些没有合法签名的交易。如果没有这一点，那么密码学上的保证也就没有用武之地。打个比方，就好比你去银行取钱，按照规定你取钱得出示合法证件，然后银行工作人员才能把钱给你。这个合法证件就相当于密码学上的签名。密码学的性质保证了别人无法伪造你的签名，也就无法伪造你的身份。

发言人 11:07
前面我们讲密码学原理时，讲到产生私钥和签名时都要有好的随机源。产生的随机数要足够随机，就是为了这种密码学上的性质。但是光有这一条是不够的，银行工作人员还要遵守规定，不会把钱交给那些没有合法证件的人。只有这两条合在一起，才能保证别人无法把你账上的钱取走。大家有什么问题吗？

发言人 12:01
没有问题。我们接下来讲一些与挖矿相关的内容。

发言人 12:08
挖矿设备的演化趋势是越来越专业化。最早大家用普通的 CPU 挖矿，像家里的计算机、笔记本电脑都可以用来挖矿。但是如果你买一台计算机专门用来挖矿，其实是非常不划算的。计算机中的大部分内存都是闲置的，挖矿只用到很少一部分内存。CPU 中的大部分部件也是闲置的，因为挖矿中计算哈希值的操作只用到通用 CPU 中的很少一部分指令，硬盘和其他很多资源也都是闲置的。所以随着比特币挖矿难度的提高，用 CPU 挖矿，用通用计算机挖矿，很快就变得无利可图了。

发言人 13:13
因为性价比太低。所以挖矿设备就转入第二代设备——GPU。第一代是 CPU，第二代是 GPU。

发言人 13:33
GPU 挖矿比 CPU 挖矿的效率提高了很多。大家知道，GPU 主要用于大规模的并行计算。像深度学习中用 GPU 就用得很多，它有大量的矩阵乘法。但是 GPU 用来挖矿其实还是有点浪费。为什么？因为 GPU 是为了通用并行计算而设计的，用来挖矿的话，里面有很多部件仍然是闲置状态。比如用于浮点数运算的部件，这些部件对于深度学习来说很重要，计算梯度需要用到浮点数运算。但是比特币的挖矿只用到整数操作，所以 GPU 挖矿比 CPU 效率有很大提高，但仍然有不少浪费。

发言人 14:40
顺便说一下，最近几年 GPU 的价格涨得很快。有些人把它归因于深度学习的火热。其实有很多 GPU 是用来挖矿的。不过有一个好消息，现在比特币挖矿难度的提升，用 GPU 挖矿已经不划算了。它已经超过了 GPU 的算力范围。所以现在没有那么多人因为挖矿而竞争购买 GPU 了，可以把这些 GPU 留给深度学习和打游戏等应用。

发言人 15:27
有一些新开发的加密货币还用 GPU 挖矿。那么现在一般用什么挖矿呢？用 ASIC 芯片。

发言人 15:43
大家知道 ASIC 是什么意思吧？

发言人 16:12
这是专门为了挖矿而设计的芯片，上面没有多余的电路逻辑，整个芯片就是为了比特币挖矿计算哈希值的操作而设计的，所以它的性价比是最高的。这个芯片也干不了别的，除了挖矿之外，别的什么事都干不了。而且为某一种加密货币设计的 ASIC 芯片，只能挖这种加密货币，挖别的就不行，除非这两个加密货币用同一个挖矿难题。

发言人 17:02
挖矿时求解的难题叫 mining puzzle。有些加密货币在新发行时，为了解决冷启动问题，故意用一个已有的加密货币的 mining puzzle。比如说跟比特币一样的 mining puzzle，这样可以吸引更多的人来挖矿，这种情况叫做 merged mining。

发言人 17:33
除了这种情况外，其他的都是一个芯片只能为一个加密货币挖矿。ASIC 芯片的研发周期很长，一款芯片从设计、流片到最后生产出来需要很长时间。像比特币的 ASIC 芯片可能需要一年的时间，而这已经算是非常快的了。与通用芯片相比，这样的研发速度基本上可以说是创造了芯片史上的奇迹。在这么长的周期内，如果比特币价格出现剧烈变化，前期投入的研发费用可能就打水漂了。

发言人 18:22
从历史上看，比特币的价格变化是比较剧烈的。曾经发生过好几次，比特币的价格在几个月内下跌了 80%，然后又慢慢恢复上去。如果放在股票市场上，基本上是不可想象的。如果比特币价格大幅度下降，挖矿可能是赔本的，可能还抵不上电费。这就是用 ASIC 芯片挖矿的情况。即使在比特币发展的黄金时期，价格不断上涨，这时挖矿是有利可图的，但竞争也越来越激烈。定制的 ASIC 芯片可能用不了几个月就过时了，又得买新的更强大的芯片，相当于一场军备竞赛。

发言人 19:24
有研究表明，一款 ASIC 矿机刚上市时，大部分利润是在上市的前两个月获得的。因为这时它的算力在同类产品中是最强的。基本上头两个月就能获得整个生命周期中一半以上的利润。然后再往后可能就要被淘汰掉，会有更强的矿机出来。所以购买矿机时，时机很重要。现在一般来说都需要提前预定。要买 ASIC 矿机，先交钱，过很长一段时间厂商才能把矿机发给你。如果厂商不能及时交货，对矿工是个很大的伤害。

发言人 20:20
有些不良厂商把 ASIC 矿机生产出来后，不是马上提供给用户，而是自己用这些矿机先挖矿，挖一段时间赚取比特币。等到最赚钱的黄金时间——头两个月过去后，才把矿机发给用户。他们找一些借口说矿机还在生产测试中。其实真正的情况是比特币系统中算力突然有了明显提高，这时大家就知道，某个大厂商的一款新矿机生产出来了。所以在比特币浪潮中，真正赚大钱的不一定是那些挖矿的，可能是卖矿机的。

发言人 21:12
总结一下，挖矿设备的演化趋势是从通用变得越来越专用。CPU 是通用计算，GPU 是通用并行计算，ASIC 则是挖矿专用。现在基本上大家都用 ASIC 芯片挖矿。ASIC 芯片除了挖矿外，别的也干不了。如果一旦过时就作废了，不像 CPU 和 GPU 还能用来干别的。有很多人认为这种情况不好，这与当初所谓的去中心化理念不符，也违背了比特币设计的初衷。

发言人 22:02
最民主的情况是大家用 CPU 挖矿，用普通家里的计算机，不论你是不是搞 IT 的，家里都有计算机，都可以用来挖矿。进入 GPU 时代后，用普通家里的计算机挖矿就已经比较困难。而且 GPU 的噪音比较大。如果一台计算机配上四块 GPU，跑起来后噪音很大，基本上人在房间里都没法呆下去。

发言人 22:37
后面会讲到有些新的加密货币设计了叫 alternative mining puzzle 的机制。设计这些 mining puzzle 的一个出发点是抗 ASIC 化。

发言人 23:10
ASIC resistance.

发言人 23:19
目的是让通用计算机也能参与挖矿。大家有什么问题吗？

发言人 23:53
挖矿的另一个趋势是大型矿池的出现。单个矿工即使用了 ASIC 芯片挖矿，从平均收益上看是有利可图的，但收入非常不稳定。比特币系统中平均每十分钟出一个区块，这是说比特币系统的所有矿工作为一个整体来看，平均十分钟会产生一个区块。但具体到某一个矿工来说，他可能要挖很长时间才能挖出一个区块。比如用一台 ASIC 矿机，可能要挖 1 到 2 年才能挖出一个区块，而现在的出块奖励是 12.5 个比特币，这还是值很多钱的，有好几万美元。这样一来就像买彩票，中奖的概率很小，但挖到了就等于中了一个大奖，挖不到的话，电费就白交了。

发言人 25:06
单个矿工还有另一个问题，除了挖矿，还要承担全节点的其他责任。我们这节课开始时讲了全节点要做的事情，任务挺重的。那怎么办呢？这就是要引入矿池的概念。所谓矿池就是把矿工组织起来作为一个整体。矿池的架构一般是一个全节点驱动很多矿机。

发言人 25:55
一个矿池一般有一个矿主（pool manager），下面连着很多矿工。

发言人 26:21
矿工只负责计算哈希值，其他全节点的职责由矿主（pool manager）承担。矿主负责监听网上的交易，把这些交易组织打包成一个候选区块，同时看有没有其他节点抢先发布区块，如果有的话怎么进行调整。前面说的全节点的其他功能由矿主完成，只有计算哈希值的操作由矿工实现。ASIC 芯片只能负责计算哈希值，不能干全节点的其他功能。
发言人 27:10
矿池的出现还有另外一个目的，就是为了解决收入不稳定的问题。我们说单个矿工的收入是不稳定的，所以大家合在一起干，有了收益之后，大家一起分配。这就牵扯到一个收益该如何分配的问题。矿池一般来说有两种组织形式，一种是像大型数据中心那样物理上集中在一起。就像我们看到的一些互联网公司，它们有成千上万的服务器，那么大的矿池里面也有成千上万的矿机。这些矿机如果是属于同一个机构的话，那么这个收入怎么分配就无所谓了。但也有的时候这些矿机是来自于不同机构的。

发言人 28:02
第二种组织方式就是分布式的。这个矿工和矿主不在同一个地方，可能分散在世界各地。矿工要加入一个矿池，就是按照这个矿池规定的通讯协议与矿主联系。然后矿主把要计算的哈希值的任务分配给他，矿工计算完之后，把结果返回给矿主。将来有出块奖励的时候，一起参与分红。大家听明白了吗？就是这么一个过程。

发言人 28:45
如果矿工是来自于五湖四海的，不是属于同一个机构的，利益该怎么分配？平均分配行不行？比如说每个矿工挖出一个区块，得到区块出块奖励，然后平分给其他矿工，这样行吗？

发言人 29:14
这样一个明显的问题是什么？是吃大锅饭，干好干坏一个样。所以如果是这样的话，有的矿工可能就不干活了。因为挖矿还要费电，他还要交电费，所以他就尽量少挖。因此我们要分配收益，要按照每个矿工的贡献大小进行分配。也就是说我们同样需要工作量证明，证明每个矿工所做的工作。

发言人 29:45
那怎么证明呢？怎么证明每个矿工做了多少工作？其实这个想法很简单，为什么矿工的收入会不稳定？因为挖矿太难了。如果我们把挖矿的难度降低之后，矿工的收入就会变得稳定了。怎么降低难度呢？比如说我们原来的要求是矿工要找到一个 nonce。

发言人 30:25
用这个 nonce 计算区块头的哈希值，前面至少有 70 个 0 才是合法的区块，这是我们原来的要求。现在我们降低挖矿难度之后，比如说前面只要有 60 个 0 就行了，这样挖到的叫做一个 share。

发言人 31:05
这个 share 叫做 almost valid block。

发言人 31:23
大家听明白了吗？原来挖矿难度太高，可能要挖上一两年才能挖到一个区块，所以矿工的收入就不稳定。我们把挖矿难度降下来，只要挖到这个区块差不多符合难度要求就可以了。

发言人 31:46
矿工挖到这样的 share 之后，这个 almost valid block 之后，把它提交给矿主。矿主拿到这个区块有什么用呢？没有用处。这个除了作为证明矿工所做的工作量之外，没有其他用处。矿主不可能把这个区块发布出去，得到区块奖励或者别的什么好处，因为这个区块不是合法的。所以矿主就记录一下每个矿工提交了多少这样的 share，这样的 almost valid block。将来等到某个矿工真的挖到了合法的区块之后，再把出块奖励按照每个矿工所做的工作量，提交的 share 数目进行分配。大家听明白了吗？好，大家想一下为什么这是可行的？

发言人 33:02
每个矿工挖到矿的概率取决于什么？每个矿工挖到矿的概率取决于他尝试的 nonce 数目。他尝试的 nonce 越多，能够找到的 share 就越多，这种 almost valid block 就越多。所以我们可以用矿工提交的 share 数目作为他做了多少工作的一个衡量。

发言人 33:32
大家有问题吗？没有问题。我来提一个问题，有没有可能某个矿工挖到一个合法的区块之后，不把它提交给矿主，而是自己偷偷摸摸地发布出去得到出块奖励。就所谓的他偷这个出块奖励。他平时挖的时候，如果挖的是一个 share，一个 almost valid block，他把这个 share 提交给矿主，作为自己的一个工作量证明。等到他真正挖到一个合法的区块的时候，他就不提交了，他自己去发布得到出块奖励。

发言人 34:15
有没有可能哪个矿工会这么做？这是不可能的。为什么？每个矿工的任务是由矿主来分配的，矿主负责组装好一个区块，然后交给矿工去尝试各种 nonce。而且我们前面还讲过，光是调整这个 nonce 这个域一般来说是不够的，还需要调整 coinbase parameter。所以矿主可能就是把不同的 coinbase parameter 所对应的 nonce 值的范围交给不同的矿工去尝试。

发言人 34:56
这个区块里面包含一个什么？coinbase transaction 里面有一个收款人的地址，这个地址填的是矿主的地址，这个 pool manager 的地址。所以矿工挖到这个区块之后，如果他不提交给矿主的话，他自己发不出去是没有用的。里面那个收款地址是矿主的，他取不出钱来。大家听明白了吗？所以只要他是按照当初矿主给他分配的任务进行挖矿的，就不可能偷出块奖励。

发言人 35:34
如果他一开始就不管矿主的任务，自己组装一个区块，偷偷地把收款地址改成自己的地址会怎么样？那样的话他提交这个 share 给矿主，矿主是不认的。因为你看里面那个交易列表已经被改过了。coinbase transaction 的内容发生变化，算出的这个 merkle tree 的根哈希值也是不一样的。所以这种情况矿主是不会认为是工作量证明的。就相当于这个矿工从一开始就是自己单干，跟矿池是没关系了。

发言人 36:16
第二个问题，我们刚才说了，他不可能偷出块奖励，但是他有没有可能捣乱？比如说平时挖到一个 share，他提交给矿主作为工作量证明。等他挖到一个真正合法的区块之后，他把它扔掉不提交，把它丢弃掉。有没有可能这样做？

发言人 36:43
有可能的。如果这个矿工就是想捣乱的话，他可以这样做。这样做对他来说并没有什么经济上的好处。本来他挖到一个合法的区块，如果提交上去的话，得到的出块奖励大家都可以分到一份，他自己也可以得一份。他现在把这个扔掉之后，谁也得不到了，所以好像是损人不利己。

发言人 37:11
但是矿池之间是存在竞争关系的，所以有可能他为了打击竞争对手，故意派一些矿工加入到竞争对手的矿池里去挖矿，然后采用这种方法来起到一些搞破坏的作用。就等于这些矿工还是参与了分红，分的是别的矿工挖出来的出块奖励，他自己挖到的区块就把它丢掉。这是搞破坏的方法。

发言人 37:44
下面我们看一些关于矿池的统计数据，这部分内容我们会用一下 PPT。这个显示的是矿池在各个国家的分布比例。按照这个网站的统计，中国的矿池占到了 81%的算力，远远超过其他国家。所以如果把所有在中国的矿池的算力作为一个整体来看的话，在比特币系统中是有绝对优势的。

发言人 38:16
如果看单个矿池的话，在 2014 年的时候，曾经有个叫 GHash.IO 的矿池。这个矿池的算力占到了全球算力的一半以上。这在当时引起了一些恐慌，这一个矿池的算力就已经足以发动 51%的攻击了。这个事情公布出来之后，GHash 这个矿池主动地把算力占比大幅度减少，以免动摇大家对比特币的信心。这是目前的算力分布，看上去没有这么集中了。前面说的那个 GHash 矿池已经不存在了，早就停止运营了。当然挖矿集中化的程度仍然是比较大的，几个大型矿池占了相当大的比重，但是没有哪个矿池占到一半以上。这样看好像比较安全了，但可能只是一个表面现象。

发言人 39:24
假设某个机构有半数以上的算力。他不一定要把所有的算力都放在一个矿池里，而是可以把这些算力分散隐藏在很多个矿池里面。平时的时候是分散隐藏的，真正需要发动攻击的时候，再集中起来发动攻击。矿工转换矿池是很容易的。我们前面讲过，加入一个矿池，就是按照这个矿池的协议与矿主联系，矿主把组装好的区块信息发给矿工，矿工来尝试各种 nonce 值就可以了。那么要换到另外一个矿池，就是按照另外一个矿池的通讯协议与那个矿主联系就可以了，所以转换矿池是很容易的。这就是矿池带来的一个危害。

发言人 40:21
如果没有矿池的话，要想发动 51%的攻击，这个攻击者自己要投入大量的硬件成本来购买到足够的矿机，能够达到系统中半数以上的算力。有了矿池之后，他自己可能只占很少比例的算力。只要能够吸引到足够多的矿工，就足够多的不明真相的群众加入到他这个矿池里来就行了。

发言人 40:56
一般来说，矿池的矿主要收取一定比例的出块奖励作为管理费。他要管理经营这个矿池，他也是要有一定的收益的。他按照一定的比例抽取管理费。有的是按照出块奖励的比例，也有的是抽取交易费。有一些有恶意的矿池，在发动攻击之前，可能故意把管理费降得特别低，甚至是赔本赚吆喝。吸引到足够多的矿工加入之后，然后就可以发动攻击。大家听明白吗？这实际上是大型矿池的一个弊病，使得 51%的攻击更加容易。那么假设有某个矿池占到了半数以上的算力，它具体能够发动哪些攻击呢？

发言人 42:33
一个最常见的攻击就是分叉攻击，forking attack。比如说这是一条区块链。这个地方有某个大额的转账交易，A 转给 B 很多比特币。等了六个确认区块，这时候 B 认为这个交易已经安全了，A 在前面发动一个分叉攻击。

发言人 43:09
把钱转给他自己。那么分叉之后要让下面这条链成为最长合法链。这个看上去好像追赶的道路是很漫长，要比上面这条链还要长。但是如果攻击者有 51%的算力的话，那么下面这条链的平均增长速度是比上面这条链要快的。所以他最终还是会成为最长合法链。到那个时候，A 到 B 的转账交易就被回滚了。

发言人 43:47
大家听明白了吗？为什么我们说攻击者，他矿池里的这些矿工是不明真相的群众？因为每个矿工只是负责计算哈希值，他并不知道网上有什么样的交易，发布什么样的区块，并不知道这种 double spending 的出现，他根本就不知道有这种分叉攻击的存在。另外，不要把 51%的阈值当做是一个绝对的门槛，是达到 51%就可以发动攻击，不到 51%就不能发动攻击，这其实都是概率。而且每个矿池所占的算力比重本身也是一个估计而已，而且是在不断变化。这是第一种分叉攻击。

发言人 44:51
攻击者还能干什么坏事？

发言人 45:04
还可以做 boycott，就是封锁禁用。比如说攻击者不喜欢某个账户，像 A 这个账户，他怀疑 A 这个账户上参与一些非法交易，想把这个账户封锁掉，所有跟 A 这个账户相关的交易都不让上链，那么怎么办呢？如果有人把像这种交易 A 转给 B 的交易发布到区块链上，那么他马上进行分叉。

发言人 45:46
产生一个不包含这个交易的区块，所有跟 A 这个账户有关的交易他都不包含进去。这种方法跟我们前面讲的为了回滚，为了 double spending 的一个区别是什么？它这个时候没必要等后面六个确认区块，这个时候等是为了让 B 放心。B 以为后面有六个确认区块都已经没事了，然后再发动分叉攻击。如果目的是为了 boycott 的话，没有这个必要。

发言人 46:40
这个交易一上链的时候，马上就可以分叉，越早越好。因为你实际上是希望别人沿着你这个链往下挖的。这个情况我们以前曾经在课上讲过一个类似的场景，大家还记得吗？

发言人 47:02
我们以前讲分布式共识协议的时候，我们说即使系统当中大部分算力是掌握在好人手里，掌握在诚实的矿工手里。也不是说记账权就不可能落到坏人手里，因为它都是一种概率。如果某一次因为概率上的原因，有个坏的节点获得记账权，他能干什么事情？

发言人 47:38
他能不能故意不把某些交易打包到发布的区块里？这是我们以前的课上问过的一个问题。当时我们说是可以的，因为比特币协议当中并没有规定发布的区块里必须包含某些交易。但是这个是没有关系的。因为他不打包的话，发布下一个区块的矿工仍然可以把这些交易打包到区块里。

发言人 48:11
但是如果这个坏人拥有 51%以上的算力的话，那么情况就不一样了。他可能是仗着自己算力强，公开抵制这样的交易。只要出现这样的交易，他马上就分叉。然后他有半数以上的算力，他可以让这个分叉链变得更长。这样一来，别的矿工也不敢随便把这样的交易打包进去了，因为一打包他就分叉。这样的话别人挖出来的区块可能就白挖了。所以这是第二种 boycott 的攻击。有没有可能盗币？

发言人 49:01
有没有可能说攻击者掌握了半数以上的算力之后，把别人账上的钱转走？这是不可能的，因为他没有别人账户的私钥，没有办法伪造签名。他如果是仗着自己算力很强，强行把一个没有合法签名的交易发布到区块链上，会有什么样的结果？会造成分叉，区块链会分叉，因为诚实的矿工会沿着另外的一条分叉去挖，不会沿着他发布的这个区块往下挖。所以盗币是不可能的。好，到这里，我们今天基本上就把比特币挖矿中出现的一些问题都讲明白了。

发言人 50:01
总结一下，大型矿池的出现有一定的好处，给矿工减轻了负担。矿工只负责挖矿，计算哈希值就行了，别的事情都可以由矿主 pool manager 来完成，收入分配也更加稳定了。原来没有矿池的时候，矿工可能要挖很长时间，挖到矿之后可以得到一大笔钱。用我们前面那个买彩票的例子，原来是相当于你有很小的概率能够得到一个大奖，现在变成了什么？中奖概率提高了，你每天都有一个概率可以得到一个小的奖。大家听明白吗？以前是要么你挖不到，什么都得不到，挖到就中大奖。现在相当于你每天都可以，也不一定每天就比较容易能挖到一些 almost valid block，然后每天都有一些小的收益。

发言人 51:06
但是矿池的出现也有一定的危害。我们前面讲的，就是发动 51%的攻击变得容易了。他不一定非要自己有这么多的算力，只要他能够动员召集起来这些算力就可以了。这有点类似于我们前面说的云计算中的 on demand computing。

发言人 51:37
这有点类似于云计算中说的 on demand computing。

发言人 51:54
大家听说过这种说法吗？云计算中的一个优势是什么？是 on demand computing。你平时不用自己去维护很大的计算集群，需要用的时候可以随时召唤。他这里实际上是什么？是 on demand mining。

发言人 52:25
这就是矿池可能带来的潜在危害，大家有问题吗？好，我们这节课就先讲到这里。
